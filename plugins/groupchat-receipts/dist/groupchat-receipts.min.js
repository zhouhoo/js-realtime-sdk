!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("leancloud-realtime")):"function"==typeof define&&define.amd?define("groupchat-receipts",["exports","leancloud-realtime"],e):e(t.AV=t.AV||{},t.AV)}(this,function(t,e){"use strict";var n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function o(t,e){return t(e={exports:{}},e.exports),e.exports}var h=o(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),m=o(function(t){var e=t.exports={version:"2.5.7"};"number"==typeof __e&&(__e=e)}),v=(m.version,function(r,o,t){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(r),void 0===o)return r;switch(t){case 1:return function(t){return r.call(o,t)};case 2:return function(t,e){return r.call(o,t,e)};case 3:return function(t,e,n){return r.call(o,t,e,n)}}return function(){return r.apply(o,arguments)}}),i=function(t){return"object"==typeof t?null!==t:"function"==typeof t},a=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t},u=function(t){try{return!!t()}catch(t){return!0}},c=!u(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),f=h.document,s=i(f)&&i(f.createElement),l=!c&&!u(function(){return 7!=Object.defineProperty((t="div",s?f.createElement(t):{}),"a",{get:function(){return 7}}).a;var t}),p=Object.defineProperty,d={f:c?Object.defineProperty:function(t,e,n){if(a(t),e=function(t,e){if(!i(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!i(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}(e,!0),a(n),l)try{return p(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},_=c?function(t,e,n){return d.f(t,e,{enumerable:!((r=1)&r),configurable:!(2&r),writable:!(4&r),value:n});var r}:function(t,e,n){return t[e]=n,t},y={}.hasOwnProperty,b=function(t,e){return y.call(t,e)},g="prototype",O=function(t,e,n){var r,o,i,a=t&O.F,u=t&O.G,c=t&O.S,f=t&O.P,s=t&O.B,l=t&O.W,p=u?m:m[e]||(m[e]={}),d=p[g],y=u?h:c?h[e]:(h[e]||{})[g];for(r in u&&(n=e),n)(o=!a&&y&&void 0!==y[r])&&b(p,r)||(i=o?y[r]:n[r],p[r]=u&&"function"!=typeof y[r]?n[r]:s&&o?v(i,h):l&&y[r]==i?function(r){var t=function(t,e,n){if(this instanceof r){switch(arguments.length){case 0:return new r;case 1:return new r(t);case 2:return new r(t,e)}return new r(t,e,n)}return r.apply(this,arguments)};return t[g]=r[g],t}(i):f&&"function"==typeof i?v(Function.call,i):i,f&&((p.virtual||(p.virtual={}))[r]=i,t&O.R&&d&&!d[r]&&_(d,r,i)))};O.F=1,O.G=2,O.S=4,O.P=8,O.B=16,O.W=32,O.U=64,O.R=128;var w=O;w(w.S+w.F*!c,"Object",{defineProperty:d.f});var j=m.Object,M=function(t,e,n){return j.defineProperty(t,e,n)},P=o(function(t){t.exports={default:M,__esModule:!0}});r(P);var S,R,T,E=r(o(function(t,e){e.__esModule=!0;var n,r=(n=P)&&n.__esModule?n:{default:n};e.default=function(t,e,n){return e in t?(0,r.default)(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}})),x={}.toString,A=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==(e=t,x.call(e).slice(8,-1))?t.split(""):Object(t);var e},C=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},F=function(t){return A(C(t))},k=Math.ceil,I=Math.floor,D=function(t){return isNaN(t=+t)?0:(0<t?I:k)(t)},q=Math.min,z=Math.max,G=Math.min,V=o(function(t){var e="__core-js_shared__",n=h[e]||(h[e]={});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:m.version,mode:"pure",copyright:"Â© 2018 Denis Pushkarev (zloirock.ru)"})}),B=0,L=Math.random(),N=V("keys"),W=(S=!1,function(t,e,n){var r,o,i,a,u=F(t),c=0<(r=u.length)?q(D(r),9007199254740991):0,f=(i=c,(o=D(o=n))<0?z(o+i,0):G(o,i));if(S&&e!=e){for(;f<c;)if((a=u[f++])!=a)return!0}else for(;f<c;f++)if((S||f in u)&&u[f]===e)return S||f||0;return!S&&-1}),K=N[R="IE_PROTO"]||(N[R]="Symbol(".concat(void 0===(T=R)?"":T,")_",(++B+L).toString(36))),U="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Y=Object.keys||function(t){return function(t,e){var n,r=F(t),o=0,i=[];for(n in r)n!=K&&b(r,n)&&i.push(n);for(;e.length>o;)b(r,n=e[o++])&&(~W(i,n)||i.push(n));return i}(t,U)},H={f:Object.getOwnPropertySymbols},J={f:{}.propertyIsEnumerable},Q=Object.assign,X=!Q||u(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=Q({},t)[n]||Object.keys(Q({},e)).join("")!=r})?function(t,e){for(var n=Object(C(t)),r=arguments.length,o=1,i=H.f,a=J.f;o<r;)for(var u,c=A(arguments[o++]),f=i?Y(c).concat(i(c)):Y(c),s=f.length,l=0;l<s;)a.call(c,u=f[l++])&&(n[u]=c[u]);return n}:Q;w(w.S+w.F,"Object",{assign:X});var Z=m.Object.assign,$=r(o(function(t){t.exports={default:Z,__esModule:!0}})),tt=o(function(u,t){!function(t){var f=function(){},r=Object.prototype.hasOwnProperty,s=Object.create||function(t){var e=function(){};return e.prototype=t,new e},c=Object.keys||function(t){var e=[];for(var n in t)r.call(t,n)&&e.push(n);return e},l=function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);return t},p=Object.setPrototypeOf||l,e=Object.prototype.toString,d=Array.isArray||function(t){return"[object Array]"===e.call(t)},y=function(t){return"[object Function]"===e.call(t)},h=!0,n={toString:""};for(var o in n)n.hasOwnProperty(o)&&(h=!1);var m=h?["toString","valueOf"]:null;function v(o,i,t){for(var e,n,r=function(t){var e=c(t);if(h)for(var n,r=0;n=m[r++];)t.hasOwnProperty(n)&&e.push(n);return e}(t),a=0,u=r.length;a<u;)"__self"!==(e=r[a++])&&(n=t[e],y(n)&&(!n.prototype||!n.prototype.__self)&&-1<n.toString().indexOf(".__base")?i[e]=function(t,n){var e=o[t]?o[t]:"__constructor"===t?i.__self.__parent:f,r=function(){var t=this.__base;this.__base=r.__base;var e=n.apply(this,arguments);return this.__base=t,e};return r.__base=e,r}(e,n):i[e]=n)}function _(t,e){for(var n,r=1;n=t[r++];)e?y(n)?i.self(e,n.prototype,n):i.self(e,n):e=y(n)?i(t[0],n.prototype,n):i(t[0],n);return e||t[0]}function i(){var t=arguments,e=d(t[0]),n=e||y(t[0]),r=n?e?_(t[0]):t[0]:f,o=t[n?1:0]||{},i=t[n?2:1],a=o.__constructor||n&&r.prototype&&r.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:n?function(){return r.apply(this,arguments)}:function(){};if(!n)return a.prototype=o,a.prototype.__self=a.prototype.constructor=a,l(a,i);p(a,r);var u=(a.__parent=r).prototype,c=a.prototype=s(u);return c.__self=c.constructor=a,o&&v(u,c,o),i&&v(r,a,i),a}i.self=function(){var t=arguments,e=d(t[0])?_(t[0],t[0][0]):t[0],n=t[1],r=t[2],o=e.prototype;return n&&v(o,o,n),r&&v(e,e,r),e};var a=!0;u.exports=i,a=!1,"object"==typeof modules&&"function"==typeof modules.define&&(modules.define("inherit",function(t){t(i)}),a=!1),a&&(t.inherit=i)}(n)});if(!e.TypedMessage)throw new Error("LeanCloud Realtime SDK not installed");var et=tt(e.TypedMessage,{__constructor:function(t){this.__base(),this.timestamp=new Date(t)}});e.messageType(-101)(et),e.messageField(["timestamp"])(et),et.sendOptions={transient:!0};var nt={name:"leancloud-realtime-plugin-groupchat-receipts",messageClasses:[et],onIMClientCreate:function(o){var i=o._sendReadCommand;o._sendReadCommand=function(t){for(var e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return t.forEach(function(t){!t.transient&&2<t.members.length&&t.send(new et(t.lastMessageAt||new Date)).catch(function(t){return console.warn("Sending groupchat receipt fail: "+t.message)})}),i.call.apply(i,[o,t].concat(n))}},onConversationCreate:function(r){var o=r.queryMessages;r.queryMessages=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return!r.transient&&2<r.members.length&&!r.lastReadTimestamps&&r._fetchAllReceiptTimestamps().then(function(t){r.lastReadTimestamps=t.reduce(function(t,e){var n=e.pid,r=e.lastReadAt;return $(t,E({},n,r))},{}),r.emit("lastreadtimestampsupdate",r.lastReadTimestamps)}).catch(function(t){return console.warn("Initialize group receipts fail: "+t.message)}),o.call.apply(o,[r].concat(e))}},beforeMessageDispatch:function(t,e){return t.type!==et.TYPE||(e.lastReadTimestamps&&(e.lastReadTimestamps[t.from]=t.timestamp,e.emit("lastreadtimestampsupdate",E({},t.from,t.timestamp))),!1)}};t.GroupchatReceiptsPlugin=nt,t.ReadReceipt=et,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=groupchat-receipts.min.js.map
