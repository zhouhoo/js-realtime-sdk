!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("leancloud-realtime")):"function"==typeof define&&define.amd?define("webrtc",["exports","leancloud-realtime"],e):e(t.AV=t.AV||{},t.AV)}(this,function(t,e){"use strict";var n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function o(t,e){return t(e={exports:{}},e.exports),e.exports}var i=function(t,e){return{value:e,done:!!t}},C={},c={}.toString,a=function(t){return c.call(t).slice(8,-1)},p=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==a(t)?t.split(""):Object(t)},u=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},s=function(t){return p(u(t))},v=o(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),y=o(function(t){var e=t.exports={version:"2.5.7"};"number"==typeof __e&&(__e=e)}),f=(y.version,function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}),_=function(r,o,t){if(f(r),void 0===o)return r;switch(t){case 1:return function(t){return r.call(o,t)};case 2:return function(t,e){return r.call(o,t,e)};case 3:return function(t,e,n){return r.call(o,t,e,n)}}return function(){return r.apply(o,arguments)}},l=function(t){return"object"==typeof t?null!==t:"function"==typeof t},m=function(t){if(!l(t))throw TypeError(t+" is not an object!");return t},h=function(t){try{return!!t()}catch(t){return!0}},d=!h(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),g=v.document,b=l(g)&&l(g.createElement),w=function(t){return b?g.createElement(t):{}},S=!d&&!h(function(){return 7!=Object.defineProperty(w("div"),"a",{get:function(){return 7}}).a}),O=function(t,e){if(!l(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!l(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!l(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!l(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},E=Object.defineProperty,A={f:d?Object.defineProperty:function(t,e,n){if(m(t),e=O(e,!0),m(n),S)try{return E(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},T=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},j=d?function(t,e,n){return A.f(t,e,T(1,n))}:function(t,e,n){return t[e]=n,t},P={}.hasOwnProperty,x=function(t,e){return P.call(t,e)},I="prototype",L=function(t,e,n){var r,o,i,c=t&L.F,a=t&L.G,u=t&L.S,s=t&L.P,f=t&L.B,l=t&L.W,p=a?y:y[e]||(y[e]={}),h=p[I],d=a?v:u?v[e]:(v[e]||{})[I];for(r in a&&(n=e),n)(o=!c&&d&&void 0!==d[r])&&x(p,r)||(i=o?d[r]:n[r],p[r]=a&&"function"!=typeof d[r]?n[r]:f&&o?_(i,v):l&&d[r]==i?function(r){var t=function(t,e,n){if(this instanceof r){switch(arguments.length){case 0:return new r;case 1:return new r(t);case 2:return new r(t,e)}return new r(t,e,n)}return r.apply(this,arguments)};return t[I]=r[I],t}(i):s&&"function"==typeof i?_(Function.call,i):i,s&&((p.virtual||(p.virtual={}))[r]=i,t&L.R&&h&&!h[r]&&j(h,r,i)))};L.F=1,L.G=2,L.S=4,L.P=8,L.B=16,L.W=32,L.U=64,L.R=128;var M,R=L,N=j,D=Math.ceil,k=Math.floor,F=function(t){return isNaN(t=+t)?0:(0<t?k:D)(t)},W=Math.min,V=function(t){return 0<t?W(F(t),9007199254740991):0},G=Math.max,K=Math.min,Y=o(function(t){var e="__core-js_shared__",n=v[e]||(v[e]={});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:y.version,mode:"pure",copyright:"Â© 2018 Denis Pushkarev (zloirock.ru)"})}),B=0,q=Math.random(),U=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++B+q).toString(36))},H=Y("keys"),z=function(t){return H[t]||(H[t]=U(t))},J=(M=!1,function(t,e,n){var r,o,i,c=s(t),a=V(c.length),u=(o=a,(r=F(r=n))<0?G(r+o,0):K(r,o));if(M&&e!=e){for(;u<a;)if((i=c[u++])!=i)return!0}else for(;u<a;u++)if((M||u in c)&&c[u]===e)return M||u||0;return!M&&-1}),Q=z("IE_PROTO"),X=function(t,e){var n,r=s(t),o=0,i=[];for(n in r)n!=Q&&x(r,n)&&i.push(n);for(;e.length>o;)x(r,n=e[o++])&&(~J(i,n)||i.push(n));return i},Z="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),$=Object.keys||function(t){return X(t,Z)},tt=d?Object.defineProperties:function(t,e){m(t);for(var n,r=$(e),o=r.length,i=0;i<o;)A.f(t,n=r[i++],e[n]);return t},et=v.document,nt=et&&et.documentElement,rt=z("IE_PROTO"),ot=function(){},it="prototype",ct=function(){var t,e=w("iframe"),n=Z.length;for(e.style.display="none",nt.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),ct=t.F;n--;)delete ct[it][Z[n]];return ct()},at=Object.create||function(t,e){var n;return null!==t?(ot[it]=m(t),n=new ot,ot[it]=null,n[rt]=t):n=ct(),void 0===e?n:tt(n,e)},ut=o(function(t){var e=Y("wks"),n=v.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:U)("Symbol."+t))}).store=e}),st=A.f,ft=ut("toStringTag"),lt=function(t,e,n){t&&!x(t=n?t:t.prototype,ft)&&st(t,ft,{configurable:!0,value:e})},pt={};j(pt,ut("iterator"),function(){return this});var ht=function(t){return Object(u(t))},dt=z("IE_PROTO"),vt=Object.prototype,yt=Object.getPrototypeOf||function(t){return t=ht(t),x(t,dt)?t[dt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?vt:null},_t=ut("iterator"),mt=!([].keys&&"next"in[].keys()),gt="values",bt=function(){return this},wt=function(t,e,n,r,o,i,c){var a,u,s;u=e,s=r,(a=n).prototype=at(pt,{next:T(1,s)}),lt(a,u+" Iterator");var f,l,p,h=function(t){if(!mt&&t in _)return _[t];switch(t){case"keys":case gt:return function(){return new n(this,t)}}return function(){return new n(this,t)}},d=e+" Iterator",v=o==gt,y=!1,_=t.prototype,m=_[_t]||_["@@iterator"]||o&&_[o],g=m||h(o),b=o?v?h("entries"):g:void 0,w="Array"==e&&_.entries||m;if(w&&(p=yt(w.call(new t)))!==Object.prototype&&p.next&&lt(p,d,!0),v&&m&&m.name!==gt&&(y=!0,g=function(){return m.call(this)}),c&&(mt||y||!_[_t])&&j(_,_t,g),C[e]=g,C[d]=bt,o)if(f={values:v?g:h(gt),keys:i?g:h("keys"),entries:b},c)for(l in f)l in _||N(_,l,f[l]);else R(R.P+R.F*(mt||y),e,f);return f};wt(Array,"Array",function(t,e){this._t=s(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,i(1)):i(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])},"values");C.Arguments=C.Array;for(var Ct=ut("toStringTag"),St="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),Ot=0;Ot<St.length;Ot++){var Et=St[Ot],At=v[Et],Tt=At&&At.prototype;Tt&&!Tt[Ct]&&j(Tt,Ct,Et),C[Et]=C.Array}var jt,Pt=(jt=!0,function(t,e){var n,r,o=String(u(t)),i=F(e),c=o.length;return i<0||c<=i?jt?"":void 0:(n=o.charCodeAt(i))<55296||56319<n||i+1===c||(r=o.charCodeAt(i+1))<56320||57343<r?jt?o.charAt(i):n:jt?o.slice(i,i+2):r-56320+(n-55296<<10)+65536});wt(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=Pt(e,n),this._i+=t.length,{value:t,done:!1})});var xt=ut("toStringTag"),It="Arguments"==a(function(){return arguments}()),Lt=function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),xt))?n:It?a(e):"Object"==(r=a(e))&&"function"==typeof e.callee?"Arguments":r},Mt=ut("iterator"),Rt=y.isIterable=function(t){var e=Object(t);return void 0!==e[Mt]||"@@iterator"in e||C.hasOwnProperty(Lt(e))},Nt=o(function(t){t.exports={default:Rt,__esModule:!0}});r(Nt);var Dt=ut("iterator"),kt=y.getIteratorMethod=function(t){if(null!=t)return t[Dt]||t["@@iterator"]||C[Lt(t)]},Ft=y.getIterator=function(t){var e=kt(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return m(e.call(t))},Wt=o(function(t){t.exports={default:Ft,__esModule:!0}});r(Wt);var Vt,Gt,Kt,Yt=r(o(function(t,e){e.__esModule=!0;var n=r(Nt),u=r(Wt);function r(t){return t&&t.__esModule?t:{default:t}}e.default=function(t,e){if(Array.isArray(t))return t;if((0,n.default)(Object(t)))return function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var c,a=(0,u.default)(t);!(r=(c=a.next()).done)&&(n.push(c.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})),Bt=function(e,t,n,r){try{return r?t(m(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&m(o.call(e)),t}},qt=ut("iterator"),Ut=Array.prototype,Ht=o(function(t){var h={},d={},e=t.exports=function(t,e,n,r,o){var i,c,a,u,s,f=o?function(){return t}:kt(t),l=_(n,r,e?2:1),p=0;if("function"!=typeof f)throw TypeError(t+" is not iterable!");if(void 0===(s=f)||C.Array!==s&&Ut[qt]!==s){for(a=f.call(t);!(c=a.next()).done;)if((u=Bt(a,l,c.value,e))===h||u===d)return u}else for(i=V(t.length);p<i;p++)if((u=e?l(m(c=t[p])[0],c[1]):l(t[p]))===h||u===d)return u};e.BREAK=h,e.RETURN=d}),zt=ut("species"),Jt=function(t,e){var n,r=m(t).constructor;return void 0===r||null==(n=m(r)[zt])?e:f(n)},Qt=v.process,Xt=v.setImmediate,Zt=v.clearImmediate,$t=v.MessageChannel,te=v.Dispatch,ee=0,ne={},re="onreadystatechange",oe=function(){var t=+this;if(ne.hasOwnProperty(t)){var e=ne[t];delete ne[t],e()}},ie=function(t){oe.call(t.data)};Xt&&Zt||(Xt=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return ne[++ee]=function(){!function(t,e,n){var r=void 0===n;switch(e.length){case 0:return r?t():t.call(n);case 1:return r?t(e[0]):t.call(n,e[0]);case 2:return r?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}t.apply(n,e)}("function"==typeof t?t:Function(t),e)},Vt(ee),ee},Zt=function(t){delete ne[t]},"process"==a(Qt)?Vt=function(t){Qt.nextTick(_(oe,t,1))}:te&&te.now?Vt=function(t){te.now(_(oe,t,1))}:$t?(Kt=(Gt=new $t).port2,Gt.port1.onmessage=ie,Vt=_(Kt.postMessage,Kt,1)):v.addEventListener&&"function"==typeof postMessage&&!v.importScripts?(Vt=function(t){v.postMessage(t+"","*")},v.addEventListener("message",ie,!1)):Vt=re in w("script")?function(t){nt.appendChild(w("script"))[re]=function(){nt.removeChild(this),oe.call(t)}}:function(t){setTimeout(_(oe,t,1),0)});var ce={set:Xt,clear:Zt},ae=ce.set,ue=v.MutationObserver||v.WebKitMutationObserver,se=v.process,fe=v.Promise,le="process"==a(se);function pe(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=t,r=e}),this.resolve=f(n),this.reject=f(r)}var he={f:function(t){return new pe(t)}},de=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}},ve=v.navigator,ye=ve&&ve.userAgent||"",_e=function(t,e){if(m(t),l(e)&&e.constructor===t)return e;var n=he.f(t);return(0,n.resolve)(e),n.promise},me=ut("species"),ge=ut("iterator"),be=!1;try{[7][ge]().return=function(){be=!0}}catch(t){}var we,Ce,Se,Oe,Ee,Ae,Te=ce.set,je=function(){var n,r,o,t=function(){var t,e;for(le&&(t=se.domain)&&t.exit();n;){e=n.fn,n=n.next;try{e()}catch(t){throw n?o():r=void 0,t}}r=void 0,t&&t.enter()};if(le)o=function(){se.nextTick(t)};else if(!ue||v.navigator&&v.navigator.standalone)if(fe&&fe.resolve){var e=fe.resolve(void 0);o=function(){e.then(t)}}else o=function(){ae.call(v,t)};else{var i=!0,c=document.createTextNode("");new ue(t).observe(c,{characterData:!0}),o=function(){c.data=i=!i}}return function(t){var e={fn:t,next:void 0};r&&(r.next=e),n||(n=e,o()),r=e}}(),Pe="Promise",xe=v.TypeError,Ie=v.process,Le=Ie&&Ie.versions,Me=Le&&Le.v8||"",Re=v[Pe],Ne="process"==Lt(Ie),De=function(){},ke=Ce=he.f,Fe=!!function(){try{var t=Re.resolve(1),e=(t.constructor={})[ut("species")]=function(t){t(De,De)};return(Ne||"function"==typeof PromiseRejectionEvent)&&t.then(De)instanceof e&&0!==Me.indexOf("6.6")&&-1===ye.indexOf("Chrome/66")}catch(t){}}(),We=function(t){var e;return!(!l(t)||"function"!=typeof(e=t.then))&&e},Ve=function(f,n){if(!f._n){f._n=!0;var r=f._c;je(function(){for(var u=f._v,s=1==f._s,t=0,e=function(t){var e,n,r,o=s?t.ok:t.fail,i=t.resolve,c=t.reject,a=t.domain;try{o?(s||(2==f._h&&Ye(f),f._h=1),!0===o?e=u:(a&&a.enter(),e=o(u),a&&(a.exit(),r=!0)),e===t.promise?c(xe("Promise-chain cycle")):(n=We(e))?n.call(e,i,c):i(e)):c(u)}catch(t){a&&!r&&a.exit(),c(t)}};r.length>t;)e(r[t++]);f._c=[],f._n=!1,n&&!f._h&&Ge(f)})}},Ge=function(i){Te.call(v,function(){var t,e,n,r=i._v,o=Ke(i);if(o&&(t=de(function(){Ne?Ie.emit("unhandledRejection",r,i):(e=v.onunhandledrejection)?e({promise:i,reason:r}):(n=v.console)&&n.error&&n.error("Unhandled promise rejection",r)}),i._h=Ne||Ke(i)?2:1),i._a=void 0,o&&t.e)throw t.v})},Ke=function(t){return 1!==t._h&&0===(t._a||t._c).length},Ye=function(e){Te.call(v,function(){var t;Ne?Ie.emit("rejectionHandled",e):(t=v.onrejectionhandled)&&t({promise:e,reason:e._v})})},Be=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),Ve(e,!0))},qe=function(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw xe("Promise can't be resolved itself");(n=We(t))?je(function(){var e={_w:r,_d:!1};try{n.call(t,_(qe,e,1),_(Be,e,1))}catch(t){Be.call(e,t)}}):(r._v=t,r._s=1,Ve(r,!1))}catch(t){Be.call({_w:r,_d:!1},t)}}};Fe||(Re=function(t){!function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!")}(this,Re,Pe,"_h"),f(t),we.call(this);try{t(_(qe,this,1),_(Be,this,1))}catch(t){Be.call(this,t)}},(we=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=function(t,e,n){for(var r in e)n&&t[r]?t[r]=e[r]:j(t,r,e[r]);return t}(Re.prototype,{then:function(t,e){var n=ke(Jt(this,Re));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=Ne?Ie.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&Ve(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),Se=function(){var t=new we;this.promise=t,this.resolve=_(qe,t,1),this.reject=_(Be,t,1)},he.f=ke=function(t){return t===Re||t===Oe?new Se(t):Ce(t)}),R(R.G+R.W+R.F*!Fe,{Promise:Re}),lt(Re,Pe),Ae="function"==typeof y[Ee=Pe]?y[Ee]:v[Ee],d&&Ae&&!Ae[me]&&A.f(Ae,me,{configurable:!0,get:function(){return this}}),Oe=y[Pe],R(R.S+R.F*!Fe,Pe,{reject:function(t){var e=ke(this);return(0,e.reject)(t),e.promise}}),R(R.S+!0*R.F,Pe,{resolve:function(t){return _e(this===Oe?Re:this,t)}}),R(R.S+R.F*!(Fe&&function(t,e){if(!e&&!be)return!1;var n=!1;try{var r=[7],o=r[ge]();o.next=function(){return{done:n=!0}},r[ge]=function(){return o},t(r)}catch(t){}return n}(function(t){Re.all(t).catch(De)})),Pe,{all:function(t){var c=this,e=ke(c),a=e.resolve,u=e.reject,n=de(function(){var r=[],o=0,i=1;Ht(t,!1,function(t){var e=o++,n=!1;r.push(void 0),i++,c.resolve(t).then(function(t){n||(n=!0,r[e]=t,--i||a(r))},u)}),--i||a(r)});return n.e&&u(n.v),e.promise},race:function(t){var e=this,n=ke(e),r=n.reject,o=de(function(){Ht(t,!1,function(t){e.resolve(t).then(n.resolve,r)})});return o.e&&r(o.v),n.promise}}),R(R.P+R.R,"Promise",{finally:function(e){var n=Jt(this,y.Promise||v.Promise),t="function"==typeof e;return this.then(t?function(t){return _e(n,e()).then(function(){return t})}:e,t?function(t){return _e(n,e()).then(function(){throw t})}:e)}}),R(R.S,"Promise",{try:function(t){var e=he.f(this),n=de(t);return(n.e?e.reject:e.resolve)(n.v),e.promise}});var Ue=y.Promise,He=r(o(function(t){t.exports={default:Ue,__esModule:!0}})),ze={f:Object.getOwnPropertySymbols},Je={f:{}.propertyIsEnumerable},Qe=Object.assign,Xe=!Qe||h(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=Qe({},t)[n]||Object.keys(Qe({},e)).join("")!=r})?function(t,e){for(var n=ht(t),r=arguments.length,o=1,i=ze.f,c=Je.f;o<r;)for(var a,u=p(arguments[o++]),s=i?$(u).concat(i(u)):$(u),f=s.length,l=0;l<f;)c.call(u,a=s[l++])&&(n[a]=u[a]);return n}:Qe;R(R.S+R.F,"Object",{assign:Xe});var Ze=y.Object.assign,$e=r(o(function(t){t.exports={default:Ze,__esModule:!0}})),tn=r(o(function(t,e){e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}})),en={f:ut},nn=en.f("iterator"),rn=o(function(t){t.exports={default:nn,__esModule:!0}});r(rn);var on=o(function(t){var n=U("meta"),e=A.f,r=0,o=Object.isExtensible||function(){return!0},i=!h(function(){return o(Object.preventExtensions({}))}),c=function(t){e(t,n,{value:{i:"O"+ ++r,w:{}}})},a=t.exports={KEY:n,NEED:!1,fastKey:function(t,e){if(!l(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!x(t,n)){if(!o(t))return"F";if(!e)return"E";c(t)}return t[n].i},getWeak:function(t,e){if(!x(t,n)){if(!o(t))return!0;if(!e)return!1;c(t)}return t[n].w},onFreeze:function(t){return i&&a.NEED&&o(t)&&!x(t,n)&&c(t),t}}}),cn=(on.KEY,on.NEED,on.fastKey,on.getWeak,on.onFreeze,A.f),an=function(t){var e=y.Symbol||(y.Symbol={});"_"==t.charAt(0)||t in e||cn(e,t,{value:en.f(t)})},un=Array.isArray||function(t){return"Array"==a(t)},sn=Z.concat("length","prototype"),fn={f:Object.getOwnPropertyNames||function(t){return X(t,sn)}},ln=fn.f,pn={}.toString,hn="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],dn={f:function(t){return hn&&"[object Window]"==pn.call(t)?function(t){try{return ln(t)}catch(t){return hn.slice()}}(t):ln(s(t))}},vn=Object.getOwnPropertyDescriptor,yn={f:d?vn:function(t,e){if(t=s(t),e=O(e,!0),S)try{return vn(t,e)}catch(t){}if(x(t,e))return T(!Je.f.call(t,e),t[e])}},_n=on.KEY,mn=yn.f,gn=A.f,bn=dn.f,wn=v.Symbol,Cn=v.JSON,Sn=Cn&&Cn.stringify,On="prototype",En=ut("_hidden"),An=ut("toPrimitive"),Tn={}.propertyIsEnumerable,jn=Y("symbol-registry"),Pn=Y("symbols"),xn=Y("op-symbols"),In=Object[On],Ln="function"==typeof wn,Mn=v.QObject,Rn=!Mn||!Mn[On]||!Mn[On].findChild,Nn=d&&h(function(){return 7!=at(gn({},"a",{get:function(){return gn(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=mn(In,e);r&&delete In[e],gn(t,e,n),r&&t!==In&&gn(In,e,r)}:gn,Dn=function(t){var e=Pn[t]=at(wn[On]);return e._k=t,e},kn=Ln&&"symbol"==typeof wn.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof wn},Fn=function(t,e,n){return t===In&&Fn(xn,e,n),m(t),e=O(e,!0),m(n),x(Pn,e)?(n.enumerable?(x(t,En)&&t[En][e]&&(t[En][e]=!1),n=at(n,{enumerable:T(0,!1)})):(x(t,En)||gn(t,En,T(1,{})),t[En][e]=!0),Nn(t,e,n)):gn(t,e,n)},Wn=function(t,e){m(t);for(var n,r=function(t){var e=$(t),n=ze.f;if(n)for(var r,o=n(t),i=Je.f,c=0;o.length>c;)i.call(t,r=o[c++])&&e.push(r);return e}(e=s(e)),o=0,i=r.length;o<i;)Fn(t,n=r[o++],e[n]);return t},Vn=function(t){var e=Tn.call(this,t=O(t,!0));return!(this===In&&x(Pn,t)&&!x(xn,t))&&(!(e||!x(this,t)||!x(Pn,t)||x(this,En)&&this[En][t])||e)},Gn=function(t,e){if(t=s(t),e=O(e,!0),t!==In||!x(Pn,e)||x(xn,e)){var n=mn(t,e);return!n||!x(Pn,e)||x(t,En)&&t[En][e]||(n.enumerable=!0),n}},Kn=function(t){for(var e,n=bn(s(t)),r=[],o=0;n.length>o;)x(Pn,e=n[o++])||e==En||e==_n||r.push(e);return r},Yn=function(t){for(var e,n=t===In,r=bn(n?xn:s(t)),o=[],i=0;r.length>i;)!x(Pn,e=r[i++])||n&&!x(In,e)||o.push(Pn[e]);return o};Ln||(N((wn=function(){if(this instanceof wn)throw TypeError("Symbol is not a constructor!");var e=U(0<arguments.length?arguments[0]:void 0),n=function(t){this===In&&n.call(xn,t),x(this,En)&&x(this[En],e)&&(this[En][e]=!1),Nn(this,e,T(1,t))};return d&&Rn&&Nn(In,e,{configurable:!0,set:n}),Dn(e)})[On],"toString",function(){return this._k}),yn.f=Gn,A.f=Fn,fn.f=dn.f=Kn,Je.f=Vn,ze.f=Yn,en.f=function(t){return Dn(ut(t))}),R(R.G+R.W+R.F*!Ln,{Symbol:wn});for(var Bn="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),qn=0;Bn.length>qn;)ut(Bn[qn++]);for(var Un=$(ut.store),Hn=0;Un.length>Hn;)an(Un[Hn++]);R(R.S+R.F*!Ln,"Symbol",{for:function(t){return x(jn,t+="")?jn[t]:jn[t]=wn(t)},keyFor:function(t){if(!kn(t))throw TypeError(t+" is not a symbol!");for(var e in jn)if(jn[e]===t)return e},useSetter:function(){Rn=!0},useSimple:function(){Rn=!1}}),R(R.S+R.F*!Ln,"Object",{create:function(t,e){return void 0===e?at(t):Wn(at(t),e)},defineProperty:Fn,defineProperties:Wn,getOwnPropertyDescriptor:Gn,getOwnPropertyNames:Kn,getOwnPropertySymbols:Yn}),Cn&&R(R.S+R.F*(!Ln||h(function(){var t=wn();return"[null]"!=Sn([t])||"{}"!=Sn({a:t})||"{}"!=Sn(Object(t))})),"JSON",{stringify:function(t){for(var e,n,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);if(n=e=r[1],(l(e)||void 0!==t)&&!kn(t))return un(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!kn(e))return e}),r[1]=e,Sn.apply(Cn,r)}}),wn[On][An]||j(wn[On],An,wn[On].valueOf),lt(wn,"Symbol"),lt(Math,"Math",!0),lt(v.JSON,"JSON",!0),an("asyncIterator"),an("observable");var zn=y.Symbol,Jn=o(function(t){t.exports={default:zn,__esModule:!0}});r(Jn);var Qn=o(function(t,e){e.__esModule=!0;var n=i(rn),r=i(Jn),o="function"==typeof r.default&&"symbol"==typeof n.default?function(t){return typeof t}:function(t){return t&&"function"==typeof r.default&&t.constructor===r.default&&t!==r.default.prototype?"symbol":typeof t};function i(t){return t&&t.__esModule?t:{default:t}}e.default="function"==typeof r.default&&"symbol"===o(n.default)?function(t){return void 0===t?"undefined":o(t)}:function(t){return t&&"function"==typeof r.default&&t.constructor===r.default&&t!==r.default.prototype?"symbol":void 0===t?"undefined":o(t)}});r(Qn);var Xn=r(o(function(t,e){e.__esModule=!0;var n,r=(n=Qn)&&n.__esModule?n:{default:n};e.default=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,r.default)(e))&&"function"!=typeof e?t:e}})),Zn=function(t,e){if(m(t),!l(e)&&null!==e)throw TypeError(e+": can't set as prototype!")},$n={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,r){try{(r=_(Function.call,yn.f(Object.prototype,"__proto__").set,2))(t,[]),n=!(t instanceof Array)}catch(t){n=!0}return function(t,e){return Zn(t,e),n?t.__proto__=e:r(t,e),t}}({},!1):void 0),check:Zn};R(R.S,"Object",{setPrototypeOf:$n.set});var tr=y.Object.setPrototypeOf,er=o(function(t){t.exports={default:tr,__esModule:!0}});r(er),R(R.S,"Object",{create:at});var nr=y.Object,rr=function(t,e){return nr.create(t,e)},or=o(function(t){t.exports={default:rr,__esModule:!0}});r(or);var ir=r(o(function(t,e){e.__esModule=!0;var n=i(er),r=i(or),o=i(Qn);function i(t){return t&&t.__esModule?t:{default:t}}e.default=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,o.default)(e)));t.prototype=(0,r.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(n.default?(0,n.default)(t,e):t.__proto__=e)}})),cr=o(function(t){var r=Object.prototype.hasOwnProperty,h="~";function n(){}function a(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(t,e,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var i=new a(n,r||t,o),c=h?h+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],i]:t._events[c].push(i):(t._events[c]=i,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function e(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(h=!1)),e.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(h?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},e.prototype.listeners=function(t){var e=h?h+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,i=new Array(o);r<o;r++)i[r]=n[r].fn;return i},e.prototype.listenerCount=function(t){var e=h?h+t:t,n=this._events[e];return n?n.fn?1:n.length:0},e.prototype.emit=function(t,e,n,r,o,i){var c=h?h+t:t;if(!this._events[c])return!1;var a,u,s=this._events[c],f=arguments.length;if(s.fn){switch(s.once&&this.removeListener(t,s.fn,void 0,!0),f){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,e),!0;case 3:return s.fn.call(s.context,e,n),!0;case 4:return s.fn.call(s.context,e,n,r),!0;case 5:return s.fn.call(s.context,e,n,r,o),!0;case 6:return s.fn.call(s.context,e,n,r,o,i),!0}for(u=1,a=new Array(f-1);u<f;u++)a[u-1]=arguments[u];s.fn.apply(s.context,a)}else{var l,p=s.length;for(u=0;u<p;u++)switch(s[u].once&&this.removeListener(t,s[u].fn,void 0,!0),f){case 1:s[u].fn.call(s[u].context);break;case 2:s[u].fn.call(s[u].context,e);break;case 3:s[u].fn.call(s[u].context,e,n);break;case 4:s[u].fn.call(s[u].context,e,n,r);break;default:if(!a)for(l=1,a=new Array(f-1);l<f;l++)a[l-1]=arguments[l];s[u].fn.apply(s[u].context,a)}}return!0},e.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},e.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},e.prototype.removeListener=function(t,e,n,r){var o=h?h+t:t;if(!this._events[o])return this;if(!e)return s(this,o),this;var i=this._events[o];if(i.fn)i.fn!==e||r&&!i.once||n&&i.context!==n||s(this,o);else{for(var c=0,a=[],u=i.length;c<u;c++)(i[c].fn!==e||r&&!i[c].once||n&&i[c].context!==n)&&a.push(i[c]);a.length?this._events[o]=1===a.length?a[0]:a:s(this,o)}return this},e.prototype.removeAllListeners=function(t){var e;return t?(e=h?h+t:t,this._events[e]&&s(this,e)):(this._events=new n,this._eventsCount=0),this},e.prototype.off=e.prototype.removeListener,e.prototype.addListener=e.prototype.on,e.prefixed=h,e.EventEmitter=e,t.exports=e});R(R.S+R.F*!d,"Object",{defineProperty:A.f});var ar=y.Object,ur=function(t,e,n){return ar.defineProperty(t,e,n)},sr=o(function(t){t.exports={default:ur,__esModule:!0}});r(sr);var fr=r(o(function(t,e){e.__esModule=!0;var n,o=(n=sr)&&n.__esModule?n:{default:n};e.default=function(){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,o.default)(t,r.key,r)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}()})),lr=o(function(t,e){var p;p={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(t,e){var n="string"==typeof t.initial?{state:t.initial}:t.initial,r=t.terminal||t.final,o=e||t.target||{},i=t.events||[],c=t.callbacks||{},a={},u={},s=function(t){var e=Array.isArray(t.from)?t.from:t.from?[t.from]:[p.WILDCARD];a[t.name]=a[t.name]||{};for(var n=0;n<e.length;n++)u[e[n]]=u[e[n]]||[],u[e[n]].push(t.name),a[t.name][e[n]]=t.to||e[n];t.to&&(u[t.to]=u[t.to]||[])};n&&(n.event=n.event||"startup",s({name:n.event,from:"none",to:n.state}));for(var f=0;f<i.length;f++)s(i[f]);for(var l in a)a.hasOwnProperty(l)&&(o[l]=p.buildEvent(l,a[l]));for(var l in c)c.hasOwnProperty(l)&&(o[l]=c[l]);return o.current="none",o.is=function(t){return Array.isArray(t)?0<=t.indexOf(this.current):this.current===t},o.can=function(t){return!this.transition&&void 0!==a[t]&&(a[t].hasOwnProperty(this.current)||a[t].hasOwnProperty(p.WILDCARD))},o.cannot=function(t){return!this.can(t)},o.transitions=function(){return(u[this.current]||[]).concat(u[p.WILDCARD]||[])},o.isFinished=function(){return this.is(r)},o.error=t.error||function(t,e,n,r,o,i,c){throw c||i},o.states=function(){return Object.keys(u).sort()},n&&!n.defer&&o[n.event](),o},doCallback:function(e,t,n,r,o,i){if(t)try{return t.apply(e,[n,r,o].concat(i))}catch(t){return e.error(n,r,o,i,p.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",t)}},beforeAnyEvent:function(t,e,n,r,o){return p.doCallback(t,t.onbeforeevent,e,n,r,o)},afterAnyEvent:function(t,e,n,r,o){return p.doCallback(t,t.onafterevent||t.onevent,e,n,r,o)},leaveAnyState:function(t,e,n,r,o){return p.doCallback(t,t.onleavestate,e,n,r,o)},enterAnyState:function(t,e,n,r,o){return p.doCallback(t,t.onenterstate||t.onstate,e,n,r,o)},changeState:function(t,e,n,r,o){return p.doCallback(t,t.onchangestate,e,n,r,o)},beforeThisEvent:function(t,e,n,r,o){return p.doCallback(t,t["onbefore"+e],e,n,r,o)},afterThisEvent:function(t,e,n,r,o){return p.doCallback(t,t["onafter"+e]||t["on"+e],e,n,r,o)},leaveThisState:function(t,e,n,r,o){return p.doCallback(t,t["onleave"+n],e,n,r,o)},enterThisState:function(t,e,n,r,o){return p.doCallback(t,t["onenter"+r]||t["on"+r],e,n,r,o)},beforeEvent:function(t,e,n,r,o){if(!1===p.beforeThisEvent(t,e,n,r,o)||!1===p.beforeAnyEvent(t,e,n,r,o))return!1},afterEvent:function(t,e,n,r,o){p.afterThisEvent(t,e,n,r,o),p.afterAnyEvent(t,e,n,r,o)},leaveState:function(t,e,n,r,o){var i=p.leaveThisState(t,e,n,r,o),c=p.leaveAnyState(t,e,n,r,o);return!1!==i&&!1!==c&&(p.ASYNC===i||p.ASYNC===c?p.ASYNC:void 0)},enterState:function(t,e,n,r,o){p.enterThisState(t,e,n,r,o),p.enterAnyState(t,e,n,r,o)},buildEvent:function(i,c){return function(){var t=this.current,e=c[t]||(c[p.WILDCARD]!=p.WILDCARD?c[p.WILDCARD]:t)||t,n=Array.prototype.slice.call(arguments);if(this.transition)return this.error(i,t,e,n,p.Error.PENDING_TRANSITION,"event "+i+" inappropriate because previous transition did not complete");if(this.cannot(i))return this.error(i,t,e,n,p.Error.INVALID_TRANSITION,"event "+i+" inappropriate in current state "+this.current);if(!1===p.beforeEvent(this,i,t,e,n))return p.Result.CANCELLED;if(t===e)return p.afterEvent(this,i,t,e,n),p.Result.NOTRANSITION;var r=this;this.transition=function(){return r.transition=null,r.current=e,p.enterState(r,i,t,e,n),p.changeState(r,i,t,e,n),p.afterEvent(r,i,t,e,n),p.Result.SUCCEEDED},this.transition.cancel=function(){r.transition=null,p.afterEvent(r,i,t,e,n)};var o=p.leaveState(this,i,t,e,n);return!1===o?(this.transition=null,p.Result.CANCELLED):p.ASYNC===o?p.Result.PENDING:this.transition?this.transition():void 0}}},t.exports&&(e=t.exports=p),e.StateMachine=p}),pr=(lr.StateMachine,o(function(a,t){!function(t){var s=function(){},r=Object.prototype.hasOwnProperty,f=Object.create||function(t){var e=function(){};return e.prototype=t,new e},u=Object.keys||function(t){var e=[];for(var n in t)r.call(t,n)&&e.push(n);return e},l=function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);return t},p=Object.setPrototypeOf||l,e=Object.prototype.toString,h=Array.isArray||function(t){return"[object Array]"===e.call(t)},d=function(t){return"[object Function]"===e.call(t)},v=!0,n={toString:""};for(var o in n)n.hasOwnProperty(o)&&(v=!1);var y=v?["toString","valueOf"]:null;function _(o,i,t){for(var e,n,r=function(t){var e=u(t);if(v)for(var n,r=0;n=y[r++];)t.hasOwnProperty(n)&&e.push(n);return e}(t),c=0,a=r.length;c<a;)"__self"!==(e=r[c++])&&(n=t[e],d(n)&&(!n.prototype||!n.prototype.__self)&&-1<n.toString().indexOf(".__base")?i[e]=function(t,n){var e=o[t]?o[t]:"__constructor"===t?i.__self.__parent:s,r=function(){var t=this.__base;this.__base=r.__base;var e=n.apply(this,arguments);return this.__base=t,e};return r.__base=e,r}(e,n):i[e]=n)}function m(t,e){for(var n,r=1;n=t[r++];)e?d(n)?i.self(e,n.prototype,n):i.self(e,n):e=d(n)?i(t[0],n.prototype,n):i(t[0],n);return e||t[0]}function i(){var t=arguments,e=h(t[0]),n=e||d(t[0]),r=n?e?m(t[0]):t[0]:s,o=t[n?1:0]||{},i=t[n?2:1],c=o.__constructor||n&&r.prototype&&r.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:n?function(){return r.apply(this,arguments)}:function(){};if(!n)return c.prototype=o,c.prototype.__self=c.prototype.constructor=c,l(c,i);p(c,r);var a=(c.__parent=r).prototype,u=c.prototype=f(a);return u.__self=u.constructor=c,o&&_(a,u,o),i&&_(r,c,i),c}i.self=function(){var t=arguments,e=h(t[0])?m(t[0],t[0][0]):t[0],n=t[1],r=t[2],o=e.prototype;return n&&_(o,o,n),r&&_(e,e,r),e};var c=!0;a.exports=i,c=!1,"object"==typeof modules&&"function"==typeof modules.define&&(modules.define("inherit",function(t){t(i)}),c=!1),c&&(t.inherit=i)}(n)}));if(!e.TypedMessage)throw new Error("LeanCloud Realtime SDK not installed");var hr,dr=pr(e.TypedMessage,{__constructor:function(t){this.__base(),this.payload=t}});dr.sendOptions={transient:!0},e.messageField("payload")(dr);var vr,yr,_r,mr,gr=e.messageType(-102)(hr=function(t){function e(){return tn(this,e),Xn(this,t.apply(this,arguments))}return ir(e,t),e}(dr))||hr,br=e.messageType(-103)(vr=function(t){function e(){return tn(this,e),Xn(this,t.apply(this,arguments))}return ir(e,t),e}(dr))||vr,wr=e.messageType(-104)(yr=function(t){function e(){return tn(this,e),Xn(this,t.apply(this,arguments))}return ir(e,t),e}(dr))||yr,Cr=e.messageType(-105)(_r=function(t){function e(){return tn(this,e),Xn(this,t.apply(this,arguments))}return ir(e,t),e}(dr))||_r,Sr=function(i){function c(t,e){tn(this,c);var n=Xn(this,i.call(this));n._setConversation(t),n._peerConnection=n._createPeerConnection(e),n._call=lr.create({initial:"calling",events:[{name:"connect",from:"calling",to:"connected"},{name:"close",from:"connected",to:"closed"},{name:"cancel",from:"calling",to:"canceled"},{name:"refuse",from:"calling",to:"refused"}]}),n._promises={};var r=new He(function(t){n._promises.resolveStreamReady=t}),o=new He(function(t){n._promises.resolveAccept=t});return He.all([r,o]).then(function(t){var e=Yt(t,1)[0];n._call.can("connect")&&(n._call.connect(),n.emit("connect",e))}),n}return ir(c,i),c.prototype.close=function(){var t=this;return He.resolve().then(function(){t._call.close(),t._destroyPeerConnection(),t._peerConnection.close(),t._destroy()})},c.prototype._handleCloseEvent=function(){this._call.can("close")&&(this.close(),this.emit("close"))},c.prototype._setConversation=function(t){this._conversation&&this._conversation.off("message"),t&&(this._conversation=t).on("message",this._handleMessage.bind(this))},c.prototype._destroy=function(){this._conversation.off("message")},c.prototype._createPeerConnection=function(t){var e=new RTCPeerConnection(t);return e.onicecandidate=this._handleICECandidateEvent.bind(this),e.onaddstream=this._handleAddStreamEvent.bind(this),e.onnremovestream=this._handleRemoveStreamEvent.bind(this),e.oniceconnectionstatechange=this._handleICEConnectionStateChangeEvent.bind(this),e.onsignalingstatechange=this._handleSignalingStateChangeEvent.bind(this),e},c.prototype._destroyPeerConnection=function(){var t=this._peerConnection;delete t.onaddstream,delete t.onremovestream,delete t.onnicecandidate,delete t.oniceconnectionstatechange,delete t.onsignalingstatechange},c.prototype._handleMessage=function(t){return t instanceof gr?this._handleAnswer(t):t instanceof wr?this._handleRefusal():t instanceof Cr?this._handleCancelation():t instanceof br&&this._handleICECandidate(t)},c.prototype._handleICECandidate=function(t){var e=new RTCIceCandidate(t.payload);this._peerConnection&&this._peerConnection.addIceCandidate(e).catch(console.error.bind(console))},c.prototype._handleICECandidateEvent=function(t){return!(!t.candidate||!this._conversation)&&this._conversation.send(new br(t.candidate)).catch(console.error.bind(console))},c.prototype._handleAddStreamEvent=function(t){this._promises.resolveStreamReady(t.stream)},c.prototype._handleRemoveStreamEvent=function(){this._handleCloseEvent()},c.prototype._handleICEConnectionStateChangeEvent=function(){switch(this._peerConnection.iceConnectionState){case"closed":case"failed":case"disconnected":this._handleCloseEvent()}},c.prototype._handleSignalingStateChangeEvent=function(){switch(this._peerConnection.signalingState){case"closed":this._handleCloseEvent()}},c.prototype._handleAnswer=function(){throw new Error("not implemented")},c.prototype._handleRefusal=function(){throw new Error("not implemented")},c.prototype._handleCancelation=function(){throw new Error("not implemented")},fr(c,[{key:"state",get:function(){return this._call.current}}]),c}(cr),Or=function(o){function i(t,e,n){tn(this,i);var r=Xn(this,o.call(this,e,n));return r.to=t,r}return ir(i,o),i.prototype._handleAnswer=function(t){var e=new RTCSessionDescription(t.payload);this._peerConnection.setRemoteDescription(e),this._promises.resolveAccept()},i.prototype._handleRefusal=function(){this._destroyPeerConnection(),this._call.refuse(),this.emit("refuse"),this._destroy()},i.prototype.cancel=function(){var t=this;return this._call.cancel(),this._conversation.send(new Cr).then(function(){return t._destroy()})},i.prototype.close=function(){return this._call.can("cancel")?this.cancel():o.prototype.close.call(this)},i}(Sr),Er=function(i){function c(t,e,n){tn(this,c);var r=Xn(this,i.call(this,e,n));r.from=t.from;var o=new RTCSessionDescription(t.payload);return r._handleOfferPromise=r._peerConnection.setRemoteDescription(o),r}return ir(c,i),c.prototype.accept=function(t){var e=this;if(!t)throw new TypeError("a MediaStream instance is required to accept a call");return this._handleOfferPromise.then(function(){return e._peerConnection.addStream(t)}).then(function(){return e._peerConnection.createAnswer()}).then(function(t){return e._peerConnection.setLocalDescription(t)}).then(function(){return e._conversation.send(new gr(e._peerConnection.localDescription))}).then(function(){return e._promises.resolveAccept()})},c.prototype.refuse=function(){var t=this;return this._conversation.send(new wr).then(function(){t._call.refuse(),t._destroy()})},c.prototype._handleCancelation=function(){this._call.cancel(),this.emit("cancel"),this._destroy()},c}(Sr),Ar=e.messageType(-101)(mr=function(t){function e(){return tn(this,e),Xn(this,t.apply(this,arguments))}return ir(e,t),e}(dr))||mr,Tr={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302","stun:stun.ekiga.net","stun:stun.ideasip.com","stun:stun.rixtelecom.se","stun:stun.schlund.de","stun:stun.stunprotocol.org:3478","stun:stun.voiparound.com","stun:stun.voipbuster.com","stun:stun.voipstunt.com","stun:stun.voxgratia.org"]}]},jr=function(r){function o(t,e){if(tn(this,o),"string"!=typeof t)throw new TypeError("id is not a string");var n=Xn(this,r.call(this));return n.id=t,n.options=$e({RTCConfiguration:Tr},e),n}return ir(o,r),o.prototype._open=function(t,e){var r=this;return t.createIMClient(this.id,e,"webrtc").then(function(t){return r._imClient=t,r.id=t.id,t.on("message",function(t,e){return t instanceof Ar&&r._handleOffer(t,e)}),t.on("conflict",function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return r.emit.apply(r,["conflict"].concat(e))}),r})},o.prototype.close=function(){return this._imClient.close()},o.prototype.call=function(r,o){var i=this;if("string"!=typeof r)throw new TypeError("target id is not a string");if(!o)throw new TypeError("a MediaStream instance is required to make a call");return this._imClient.ping([r]).then(function(t){if(!t.length)throw new Error("Call failed as "+r+" is not online");var n=new Or(r,null,i.options.RTCConfiguration),e=new He(function(t){n._peerConnection.onnegotiationneeded=t});return n._peerConnection.addStream(o),e.then(function(){return He.all([i._imClient.createConversation({members:[r],unique:!0}),n._peerConnection.createOffer().then(function(t){n._peerConnection.setLocalDescription(t)})])}).then(function(t){var e=Yt(t,1)[0];return n._setConversation(e),e.send(new Ar(n._peerConnection.localDescription))}).then(function(){return n})})},o.prototype._handleOffer=function(t,e){var n=new Er(t,e,this.options.RTCConfiguration);this.emit("call",n)},o}(cr),Pr={name:"leancloud-realtime-plugin-webrtc",messageClasses:[Ar,gr,br,wr,Cr],onRealtimeCreate:function(n){n.createWebRTCClient=function(t,e){return new jr(t)._open(n,e)}}},xr=!!(window.RTCPeerConnection&&window.RTCSessionDescription&&window.RTCIceCandidate);t.WebRTCPlugin=Pr,t.isWebRTCSupported=xr,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=webrtc.min.js.map
